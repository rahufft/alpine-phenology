{
    "contents" : "---\ntitle: \"Alpine Phenology\"\nauthor: \"RA Hufft\"\ndate: \"August 28, 2015\"\noutput: word_document\n---\n\nThis is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.\n\nWhen you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:\n\n```{r}\nsummary(cars)\n```\n\nYou can also embed plots, for example:\n\n```{r, echo=FALSE}\nplot(cars)\n```\n\nNote that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.\n```{r}\n#Bring in Q/All.Projects_by_species/aa_Spapefiles_Maps/aa_QGIS Projects/AlpinePhenologyproject/\n\nbloom<-read.csv(path.expand(\"P:/alpine-phenology/TB_tempPrecipData.csv\"),        \n                header = TRUE, as.is=TRUE)    \n#created new column that divides Raw_precip by 100 (see PRISM documentation) to get mm\nhead(bloom)\nnames(bloom)\nstr(bloom)  #tells me column name, data type and examples\n\n#Climate data figures\n#This section runs linear regression on Avg High temp by Year\n#hist(bloom$Avg_Hi)\nplot(bloom$Year,bloom$Avg_Hi, main=\"Average High Temperature by Year\",xlab=\"Year\", ylab=\"Degrees Celsius\")\nabline(lm(bloom$Avg_Hi~bloom$Year))\nsummary(lm(bloom$Avg_Hi~bloom$Year))\n#plot(lm(bloom$Avg_Hi~bloom$Year)) #check residuals for heteroscedasticity and nonlinearity\n\n#This section runs linear regression on Avg Low temp by Year\n#hist(bloom$Avg_Lo)\nplot(bloom$Year,bloom$Avg_Lo, main=\"Average Low Temperature by Year\",xlab=\"Year\", ylab=\"Degrees Celsius\")\nabline(lm(bloom$Avg_Lo~bloom$Year))\nsummary(lm(bloom$Avg_Lo~bloom$Year))\n#plot(lm(bloom$Avg_Lo~bloom$Year)) #check residuals for heteroscedasticity and nonlinearity\n\n#This section runs linear regression on Precipitation by Year\n#hist(bloom$Precip_mm)\nplot(bloom$Year,bloom$Precip_mm, main=\"Precipitation by Year\",xlab=\"Year\", ylab=\"Precipitation (mm)\")\nabline(lm(bloom$Precip_mm~bloom$Year))\nsummary(lm(bloom$Precip_mm~bloom$Year))\n#plot(lm(bloom$Precip_mm ~bloom$Year)) #check residuals for heteroscedasticity and nonlinearity\n\n#Graph of all spp data by year\nbloom<-read.csv(path.expand(\"P:/alpine-phenology/QR_final_R_plant_climate_data.csv\"),        \n                header = TRUE, as.is=TRUE)   \nhist(bloom$startDayOfYear)\nplot(bloom$Year,bloom$startDayOfYear, main=\"First Collection Date for All Species\",xlab=\"Year\", ylab=\"Julian Date\")\nabline(lm(bloom$startDayOfYear~bloom$Year))\nsummary(lm(bloom$startDayOfYear~bloom$Year)) \n#both intercept and slope significant. If include all data, the date of first collection is statistically earlier by 0.062563/year, or 3.75 days earlier over the course of the study period. \n#plot(lm(bloom$startDayOfYear ~bloom$Year)) #check residuals for heteroscedasticity and nonlinearity\n\n#Graph just the significant spp by year to see how many days earlier for these species that are showing a signal by year\n#re-run code that runs regressions on each species to create table to subset from\n#Limit all data to after 1949, 7220 obs. from table (7217 obs. from query in Access)\nbl50 <- subset(bloom, bloom$year_plant > 1949) #Our dataset already has this subset but re-running as a double check\nstr(bl50)\nhead(bl50)\n\n# Pull out the earliest bloom date per year per species\nfoo <- function(x){min(bl50$startDayOfYear~bl50$Year)}\n\n names <- unique(bl50$Scientific.Name)\t\t# Names includes synonyms, sspListID contains unique taxa\n namesID <- unique(bl50$sppListID)\nlength(namesID)\t# 290\nhead(namesID)\nnames(bl50)\ntable(bl50$sppListID, bl50$startDayOfYear)\n\n# testing\n#namesID <- 3\n#vari <- \"Year\"\n#___START HERE NEXT TIME 20151013__________________________________________________\n\nJulBloomDate <- function(vari){\t#vari <- \"Year\"; \nsetwd(path.expand(\"Q:/Research/All_Projects_by_Species/aa_Shapefiles_Maps/aa_QGIS Projects/Alpine Phenology Project/R_figures_alpine\"))\n\tnamesID <- unique(bl50$sppListID)\n\trm(JYC)\n\tJYC <- c()\n\tstats<-c()\n\n\tfor(i in namesID){\n\t\tspsub <- subset(bl50, sppListID == i)\t\n\t\tpyr <- tapply(spsub$startDayOfYear, spsub$Year, min)\n\t\tval <- as.vector(pyr)\n\t\tyrs <- as.numeric(names(pyr))\n\t\tmins <- data.frame(cbind(julian = val, Year = yrs))\n\t\t\tblnew <- c()\n\t\t\t\tfor(j in 1:nrow(mins)){\n\t\t\t\t\tblnew <- rbind(blnew, \n\t\t\t\t\t\tsubset(spsub, \n\t\t\t\t\t\t\tspsub$startDayOfYear == mins[j,1] \n\t\t\t\t\t\t\t& spsub$Year == mins[j,2]))\n\t\t\t}\n\tblnew <- blnew[!duplicated(blnew[,c('earliestBloomDate','Year')]),]\t#get rid of duplicates for a year\n\tjpeg(filename = paste(blnew$Scientific.Name[1], vari, \".jpg\"),\n\t\tquality = 100)\ncolnum <- match(vari,names(blnew))\n\tplot(blnew[,colnum], blnew$startDayOfYear, \n\t\tmain = paste(blnew$Scientific.Name[1], vari, sep = \"\"), \n\t\tcex.main = 0.85,\n\t\txlab = paste(vari),\n\t\tylab = \"Julian date of first bloom\")\nabline(lm(blnew$startDayOfYear~blnew[,colnum]))\ndev.off()\ngraphics.off()\nfoo1 <- summary(lm(blnew$startDayOfYear~blnew[,colnum]))\njul.yr.coef <- data.frame(\n\t\t\tcbind(\n\t\t\t\tdata.frame(t(foo1$coefficients[2,])),\n\t\t\t\tfoo1$coefficients[1,1],\n\t\t\t\tt(foo1$fstatistic),\n\t\t\t\tSpecies = blnew$Scientific.Name[1],\n\t\t\t\tfoo1$adj.r.squared))\nJYC <- rbind(JYC, jul.yr.coef)\n}\n\nstr(JYC)\ncolnames(JYC) <- c(\"Slope\", \"StErr\", \"t.value\", \"p.value\", \"Intercept\", \n\t\t\t\"F Stat\", \"numDF\",\"denDF\", \"Species\", \"adj.r.squ\")\n\nJYC <<- JYC\n}\n\n\n\n\n\n########## Columns that you can use to compare to earliest bloom date (taken from \"startDayOfYear\")\nnames(bl50)\n                \n#[11] \"startDayOfYear\"   [20] \"Raw_Precip\"              \n#[21] \"Avg_Hi\"                \"Med_Hi\"                  \n#[23] \"Avg_Lo\"                \"Med_Lo\"                  \n#[25] \"Av_Temp\"               \"Med_Temp\"  \n\n#run each of the 4 following codes separately\n\nJulBloomDate(\"Year\")\n\tYearJYC <- JYC \n\nJulBloomDate(\"Raw_Precip\")\n\tRawPrecipJYC <- JYC \n\nJulBloomDate(\"Avg_Hi\")\n\tAvgHiJYC <- JYC \n\nJulBloomDate(\"Avg_Lo\")\n\tAvgLoJYC <- JYC \n\n#then run each of these lines for each of the above & past in Excel\n\nwrite.table(JYC[1:100,], \"clipboard\", sep=\"\\t\", row.names = F, col.names = T)\nwrite.table(JYC[101:200,], \"clipboard\", sep=\"\\t\", row.names = F, col.names = T)\nwrite.table(JYC[201:290,], \"clipboard\", sep=\"\\t\", row.names = F, col.names = T)\n\n###\n\n\n## Categorize slope\nnames(JYC)\nnegsl <- subset(JYC, JYC$Slope < 0 & JYC$p.value < 0.05)\n\n# How many\nlength(negsl)\nnegsl$Species\n\n## Merge Year, precip, temp...\nmerge(YearJYC, RawPrecipJYC, by = \"Species\")\n\n\n\n# cannot put the whole table, \"JYC\" into Excel w/ ctrl V - too big\n\n# species where bloom date is signficantly getting earlier (JYC is the whole table):\nsubset(JYC, JYC$Slope < 0 & JYC$p.value < 0.05)\nearlier_bloom <- subset(JYC, JYC$Slope < 0 & JYC$p.value < 0.05)\n# puts table \"earlier_bloom\" into Exel w/ ctrl V\nwrite.table (earlier_bloom,\"clipboard\", sep = \"\\t\", row.names = FALSE, col.names = TRUE)\n\n# species where bloom date is signficantly getting later: None\nsubset(JYC, JYC$Slope > 0 & JYC$p.value < 0.05)\nlater_bloom <- subset(JYC, JYC$Slope > 0 & JYC$p.value < 0.05)\n# puts table \"later_bloom\" into Exel w/ ctrl V\nwrite.table (later_bloom,\"clipboard\", sep = \"\\t\", row.names = FALSE, col.names = TRUE)\n\n\n#################\t###################################### ######################### ############################\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#merge two tables\nmerge(stats, bloom, by = intersect(names(x), names(y)),\n      by.x = by, by.y = by, all = FALSE, all.x = all, all.y = all,\n      sort = TRUE, suffixes = c(\".x\",\".y\"),\n      incomparables = NULL, ...)\n\nhist(bloom$startDayOfYear)\nplot(bloom$Year,bloom$startDayOfYear, main=\"First Collection Date for All Species\",xlab=\"Year\", ylab=\"Julian Date\")\nabline(lm(bloom$startDayOfYear~bloom$Year))\nsummary(lm(bloom$startDayOfYear~bloom$Year))\n#plot(lm(bloom$startDayOfYear ~bloom$Year)) #check residuals for heteroscedasticity and nonlinearity\n```\n\n\n\n\n\n",
    "created" : 1440788078402.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4183759104",
    "id" : "F5DCC833",
    "lastKnownWriteTime" : 1444771726,
    "path" : "P:/alpine-phenology/Climate.Rmd",
    "project_path" : "Climate.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_markdown"
}